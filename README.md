# Kristina - å‚²å¨‡AIæ¡Œå® 

Kristina æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Windows æœ¬åœ°ã€å…·æœ‰æ‹ŸäººåŒ–å‚²å¨‡æ€§æ ¼ã€é•¿æœŸè®°å¿†ã€æ”¯æŒè¯­éŸ³äº¤äº’å’Œ Live2D å½¢è±¡é©±åŠ¨çš„æ¡Œé¢å® ç‰© AI åŠ©æ‰‹ã€‚å¥¹ä½åœ¨ä½ çš„ç”µè„‘æ¡Œé¢è§’è½ï¼Œä¼šç”¨å‚²å¨‡ä½†æ¸©æŸ”çš„è¯­æ°”é™ªä¼´ä½ ã€å¸®ä½ è§£å†³é—®é¢˜ï¼Œå¹¶é€æ¸è®°ä½ä½ çš„å–œå¥½ã€‚

![Kristina ç¤ºä¾‹](docs/preview.png) <!-- å¯æ›¿æ¢ä¸ºå®é™…æˆªå›¾ -->

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- **æ‹Ÿäººæ€§æ ¼**ï¼šå‚²å¨‡ã€å¹½é»˜ã€å†…å¿ƒæ¸©æŸ”ï¼Œä¼šæ ¹æ®å¯¹è¯æƒ…å¢ƒè‡ªç„¶åˆ‡æ¢è¯­æ°”ï¼ˆç³»ç»Ÿæç¤ºè¯ç²¾å¿ƒè®¾è®¡ï¼‰ã€‚
- **é•¿æœŸè®°å¿†**ï¼šé€šè¿‡ PowerMem è®°ä½ä½ çš„ç”Ÿæ—¥ã€å–œå¥½ã€è¿‡å¾€å¯¹è¯ï¼Œéšç€äº¤æµè¶Šæ¥è¶Šæ‡‚ä½ ã€‚
- **æœ¬åœ°è¿è¡Œ**ï¼šæ‰€æœ‰å¤„ç†å‡åœ¨æœ¬åœ°å®Œæˆï¼Œä¿æŠ¤éšç§ï¼Œæ— éœ€è”ç½‘ï¼ˆé™¤å¯é€‰çš„ TTS å¤–ï¼‰ã€‚
- **è¯­éŸ³äº¤äº’**ï¼šæ”¯æŒè¯­éŸ³è¾“å…¥ï¼ˆSherpa-Onnx ASRï¼‰å’Œè¯­éŸ³è¾“å‡ºï¼ˆPiper TTS ç¦»çº¿åˆæˆï¼‰ï¼Œå‘Šåˆ«æœºæ¢°æ„Ÿã€‚
- **Live2D é©±åŠ¨**ï¼šè®¡åˆ’æ”¯æŒé€šè¿‡è¡¨æƒ…æ ‡ç­¾æ§åˆ¶ Live2D æ¨¡å‹ï¼Œè®©å½¢è±¡æ›´åŠ ç”ŸåŠ¨ã€‚
- **é«˜åº¦å¯å®šåˆ¶**ï¼šåŸºäº Open-LLM-VTuber æ¡†æ¶ï¼Œå¯è‡ªç”±æ›´æ¢ LLMã€TTSã€è®°å¿†å¼•æ“ç­‰ç»„ä»¶ã€‚

## ğŸ§  æŠ€æœ¯æ¶æ„

- **æ ¸å¿ƒæ¡†æ¶**ï¼š[Open-LLM-VTuber](https://github.com/Open-LLM-VTuber/Open-LLM-VTuber)ï¼ˆå®šåˆ¶ä¿®æ”¹ç‰ˆï¼‰
- **LLM å¼•æ“**ï¼šOllama + `goekdenizguelmez/JOSIEFIED-Qwen2.5:7b`ï¼ˆä¸­æ–‡ä¼˜åŒ–ã€è§’è‰²æ‰®æ¼”å¼ºï¼‰
- **åµŒå…¥æ¨¡å‹**ï¼šOllama + `nomic-embed-text`ï¼ˆç”¨äºè®°å¿†å‘é‡åŒ–ï¼‰
- **é•¿æœŸè®°å¿†**ï¼šPowerMemï¼ˆSQLite å­˜å‚¨ï¼Œè½»é‡æ— ä¾èµ–ï¼‰
- **è¯­éŸ³åˆæˆ**ï¼šPiper TTSï¼ˆç¦»çº¿ï¼Œä¸­æ–‡è‡ªç„¶ï¼‰
- **è¯­éŸ³è¯†åˆ«**ï¼šSherpa-Onnx ASRï¼ˆç¦»çº¿ï¼‰
- **å½¢è±¡é©±åŠ¨**ï¼šVTube Studioï¼ˆé€šè¿‡ WebSocket é›†æˆï¼Œè®¡åˆ’ä¸­ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Windows 10/11 æˆ– Linuxï¼ˆä¸»æ¨ Windowsï¼‰
- Python 3.10
- Ollamaï¼ˆå·²å®‰è£…å¹¶è¿è¡Œï¼Œæ‹‰å–äº†æ‰€éœ€æ¨¡å‹ï¼‰
- è‡³å°‘ 8GB å†…å­˜ï¼Œæ¨è 16GB
- éº¦å…‹é£ï¼ˆå¯é€‰ï¼Œç”¨äºè¯­éŸ³è¾“å…¥ï¼‰

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**ï¼ˆæ³¨æ„åŒ…å«å­æ¨¡å—ï¼‰
   ```bash
   git clone --recursive https://github.com/yourname/Kristina.git
   cd Kristina
   ```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
   ```bash
   uv sync
   ```


3. **ä¸‹è½½æ¨¡å‹æ–‡ä»¶**
   - **Ollama æ¨¡å‹**ï¼ˆç¡®ä¿ Ollama å·²è¿è¡Œï¼‰ï¼š
     ```bash
     ollama pull goekdenizguelmez/JOSIEFIED-Qwen2.5:7b
     ollama pull nomic-embed-text
     ```
   - **Piper TTS æ¨¡å‹**ï¼š
     ä» [HuggingFace](https://huggingface.co/csukuangfj/vits-piper-zh_CN-huayan-medium) ä¸‹è½½ä»¥ä¸‹æ–‡ä»¶ï¼Œæ”¾å…¥ `models/piper/` ç›®å½•ï¼š
     - `zh_CN-huayan-medium.onnx`
     - `tokens.txt`
     - `MODEL_CARD`ï¼ˆå¯é€‰ï¼‰

4. **é…ç½®**
   å¤åˆ¶ `conf.yaml.example` ä¸º `conf.yaml`ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹ï¼ˆæ¨¡å‹è·¯å¾„ã€API åœ°å€ç­‰ï¼‰ã€‚é»˜è®¤é…ç½®å·²é€‚é…æœ¬åœ° Ollama å’Œ Piper TTSã€‚

5. **å¯åŠ¨**
   ```bash
   uv run main.py
   ```
   è®¿é—® `http://localhost:12393` å³å¯ä¸ Kristina å¯¹è¯ï¼ˆæ”¯æŒè¯­éŸ³è¾“å…¥éœ€é…ç½®éº¦å…‹é£ï¼‰ã€‚

## âš™ï¸ é…ç½®è¯¦è§£

ä¸»é…ç½®æ–‡ä»¶ `conf.yaml` åŒ…å«æ‰€æœ‰æ¨¡å—è®¾ç½®ã€‚å…³é”®éƒ¨åˆ†ï¼š

### LLM é…ç½®
```yaml
agent_settings:
  basic_memory_agent:
    llm_provider: ollama_llm   # ä½¿ç”¨åŸç”Ÿ ollama LLM
    faster_first_response: true
    segment_method: pysbd
    use_mcpp: false             # æš‚æ—¶ç¦ç”¨ MCP å·¥å…·
    mcp_enabled_servers:
      - time
      - ddg-search

llm_configs:
  ollama_llm:
    interrupt_method: system
    base_url: http://localhost:11434
    model: goekdenizguelmez/JOSIEFIED-Qwen2.5:7b
    temperature: 0.8
    keep_alive: -1.0
    unload_at_exit: true
    stream: true                 # å¯ç”¨æµå¼è¾“å‡º
```

### è®°å¿†é…ç½®ï¼ˆPowerMemï¼‰
```yaml
agent_settings:
  custom_agents.powermem_agent.PowerMemAgent:
    llm_provider: ollama_llm
    powermem_user_id: kristina
    powermem_data_dir: ./powermem_data
    memory_top_k: 3
    memory_threshold: 0.6
    powermem_embed_config:
      provider: ollama
      model: nomic-embed-text
      base_url: http://localhost:11434
```

### TTS é…ç½®
```yaml
tts_model: piper_tts
piper_tts:
  model_path: models/piper/zh_CN-huayan-medium.onnx
  speaker_id: 0
  length_scale: 1.0          # è¯­é€Ÿ
  noise_scale: 0.667          # å£°éŸ³å˜åŒ–
  noise_w: 0.8                # é£æ ¼å˜åŒ–
  use_cuda: false             # CPU è¿è¡Œ
```

### ASR é…ç½®ï¼ˆè¯­éŸ³è¾“å…¥ï¼‰
```yaml
asr_model: sherpa_onnx_asr
sherpa_onnx_asr:
  model_type: sense_voice
  sense_voice: ./models/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/model.int8.onnx
  tokens: ./models/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17/tokens.txt
  num_threads: 4
  provider: cpu
  use_itn: true
```

## ğŸ­ è‡ªå®šä¹‰ä½ çš„ Kristina

### ä¿®æ”¹æ€§æ ¼
ç¼–è¾‘ `service_context.py` ä¸­çš„ `construct_system_prompt` æ–¹æ³•ï¼Œè°ƒæ•´äººæ ¼æè¿°ã€è¯­è¨€é£æ ¼ã€ç¤ºä¾‹ç­‰ã€‚å½“å‰ prompt å·²åŒ…å«ï¼š
- å‚²å¨‡è¡¨ç°æ¨¡å¼
- æ¸©æŸ”é™ªä¼´æŒ‡ä»¤
- è¯­è¨€é£æ ¼å¼ºåˆ¶è§„åˆ™ï¼ˆçŸ­å¥ã€è¯­æ°”è¯ã€å†…å¿ƒæ‹¬å·ã€åé—®å¥ï¼‰
- è¡¨æƒ…æ ‡ç­¾ç¤ºä¾‹

### æ›´æ¢ LLM
æ”¯æŒå¤šç§ LLM åç«¯ï¼ˆOllamaã€OpenAIã€Gemini ç­‰ï¼‰ï¼Œåªéœ€ä¿®æ”¹ `llm_provider` å’Œç›¸åº”é…ç½®ã€‚ä¾‹å¦‚æ”¹ç”¨ OpenAIï¼š
```yaml
llm_provider: openai_llm
openai_llm:
  base_url: https://api.openai.com/v1
  llm_api_key: sk-xxxx
  model: gpt-4
```

### æ›´æ¢ TTS
åœ¨ `conf.yaml` ä¸­æ›´æ”¹ `tts_model` ä¸º `edge_tts`ã€`coqui_tts`ã€`gpt_sovits` ç­‰ï¼Œå¹¶é…ç½®å¯¹åº”å‚æ•°ã€‚ä¾‹å¦‚æ”¹ç”¨ Edge-TTSï¼š
```yaml
tts_model: edge_tts
edge_tts:
  voice: zh-CN-XiaoxiaoNeural
```

### æ·»åŠ è‡ªå®šä¹‰å·¥å…·ï¼ˆæœªæ¥ï¼‰
è®¡åˆ’æ”¯æŒé€šè¿‡ MCP åè®®æ·»åŠ å·¥å…·ï¼Œå¦‚è®¡ç®—å™¨ã€å¤©æ°”æŸ¥è¯¢ç­‰ï¼Œè®© Kristina å…·å¤‡å®æ—¶è®¡ç®—èƒ½åŠ›ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„
```
Kristina/
â”œâ”€â”€ Open-LLM-VTuber/          # å­ä»“åº“ï¼ˆå®šåˆ¶ä¿®æ”¹ç‰ˆï¼‰
â”‚   â””â”€â”€ src/open_llm_vtuber/
â”‚       â”œâ”€â”€ agent/
â”‚       â”œâ”€â”€ config_manager/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ custom_agents/            # è‡ªå®šä¹‰ Agent
â”‚   â””â”€â”€ powermem_agent.py      # PowerMem é›†æˆ
â”œâ”€â”€ powermem_data/             # è®°å¿†æ•°æ®åº“ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ models/                    # å­˜æ”¾ TTSã€ASR ç­‰æ¨¡å‹æ–‡ä»¶
â”‚   â””â”€â”€ piper/
â”‚       â”œâ”€â”€ zh_CN-huayan-medium.onnx
â”‚       â””â”€â”€ tokens.txt
â”œâ”€â”€ conf.yaml                  # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ run.py                     # å¯åŠ¨è„šæœ¬ï¼ˆç®¡ç†è·¯å¾„ã€è°ƒç”¨å­ä»“åº“ï¼‰
â”œâ”€â”€ requirements.txt           # Python ä¾èµ–
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: è¯­éŸ³åˆæˆå¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: 
- ç¡®è®¤ Piper æ¨¡å‹è·¯å¾„æ­£ç¡®ï¼Œä¸”æ–‡ä»¶å®Œæ•´ã€‚
- æ£€æŸ¥ `piper_tts` é…ç½®ä¸­çš„ `model_path` æ˜¯å¦æŒ‡å‘ `.onnx` æ–‡ä»¶ã€‚
- è‹¥ä»å¤±è´¥ï¼Œå¯ä¸´æ—¶åˆ‡æ¢åˆ° Edge-TTS æµ‹è¯•ç½‘ç»œè¿é€šæ€§ã€‚

### Q: è®°å¿†ä¸ç”Ÿæ•ˆï¼Ÿ
A: 
- æ£€æŸ¥ PowerMem é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ `powermem_data_dir` æœ‰å†™å…¥æƒé™ã€‚
- é¦–æ¬¡ä½¿ç”¨éœ€å¯¹è¯å‡ æ¡æ‰ä¼šç§¯ç´¯è®°å¿†ï¼Œå¯æŸ¥çœ‹ `powermem_data/kristina_memory.db` æ˜¯å¦å­˜åœ¨ã€‚
- æ—¥å¿—ä¸­åº”æœ‰ `Retrieved X relevant memories` å­—æ ·ï¼Œè¡¨ç¤ºæ£€ç´¢æˆåŠŸã€‚

### Q: å¦‚ä½•å¯ç”¨ Live2Dï¼Ÿ
A: Live2D é©±åŠ¨æ­£åœ¨å¼€å‘ä¸­ï¼Œè¯·å…³æ³¨åç»­æ›´æ–°ã€‚ç›®å‰å¯ä½¿ç”¨é™æ€å¤´åƒï¼ˆé…ç½® `avatar` å­—æ®µï¼‰ã€‚

### Q: å¤´åƒä¸æ˜¾ç¤ºï¼Ÿ
A: æ£€æŸ¥ `conf.yaml` ä¸­ `avatar` å­—æ®µæ˜¯å¦æŒ‡å‘ `avatars/` ç›®å½•ä¸‹çš„å›¾ç‰‡ï¼Œä¸”æ–‡ä»¶åæ­£ç¡®ã€‚è‹¥ä»ä¸º `null`ï¼Œå¯åœ¨ `conversation_utils.py` çš„ `handle_sentence_output` ä¸­æ·»åŠ é»˜è®¤å¤´åƒé€»è¾‘ï¼ˆå‚è§å¸¸è§ä¿®æ”¹è®°å½•ï¼‰ã€‚

### Q: æµå¼è¾“å‡ºä¸èµ·ä½œç”¨ï¼Ÿ
A: 
- ç¡®è®¤ `ollama_llm` é…ç½®ä¸­ `stream: true`ã€‚
- æ£€æŸ¥ `ollama_llm.py` æ˜¯å¦å·²ä¿®æ”¹ä¸ºæ”¯æŒæµå¼ï¼ˆå‚è€ƒä¹‹å‰è®¨è®ºçš„ä»£ç ï¼‰ã€‚
- ç›®å‰å‰ç«¯æ”¯æŒ `sentence` ç±»å‹é€å¥æ˜¾ç¤ºï¼Œè‹¥éœ€é€å­—æ˜¾ç¤ºéœ€é¢å¤–å¼€å‘ã€‚

## ğŸ—ºï¸ æœªæ¥è®¡åˆ’

- [x] åŸºç¡€å¯¹è¯ä¸è®°å¿†
- [x] ç¦»çº¿ TTS æ”¯æŒï¼ˆPiperï¼‰
- [ ] æµå¼è¾“å‡ºæ¢å¤
- [ ] å·¥å…·è°ƒç”¨ï¼ˆæ—¥æœŸè®¡ç®—ã€æœç´¢ç­‰ï¼‰
- [ ] Live2D åŠ¨ä½œé©±åŠ¨
- [ ] ä¸€é”®å®‰è£…è„šæœ¬
- [ ] æ›´å¤šè¯­è¨€æ”¯æŒ
- [ ] è¡¨æƒ…æ ‡ç­¾ä¸ VTube Studio é›†æˆ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ PRï¼å¦‚æœä½ æƒ³å‚ä¸å¼€å‘ï¼Œè¯·å…ˆé˜…è¯» [CONTRIBUTING.md](CONTRIBUTING.md)ã€‚ç‰¹åˆ«æ„Ÿè°¢ [Open-LLM-VTuber](https://github.com/Open-LLM-VTuber/Open-LLM-VTuber) é¡¹ç›®æä¾›çš„å¼ºå¤§æ¡†æ¶ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚